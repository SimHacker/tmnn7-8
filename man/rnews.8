.if n .ds La '
.if n .ds Ra '
.if t .ds La `
.if t .ds Ra '
.if n .ds Lq "
.if n .ds Rq "
.if t .ds Lq ``
.if t .ds Rq ''
.de Ch
\\$3\\*(Lq\\$1\\*(Rq\\$2
..
.TH RNEWS 8 "Mar 17, 1989"
.ds ]W News 3.0 (beta level 7)
.SH NAME
rnews \- submit news articles
.SH SYNOPSIS
.BI "rnews [\-p " pathname "]"
[
.BI \-U
] [
.BI \-P
] [
.BI \-D
] [
.BI \-d
] [
.BI \-o filenum
] [
.BI \-x systems
]
.PP
.SH DESCRIPTION
.I Rnews
transmits or retransmits news articles to the USENET news network.
It is intended as a back end, not an interface program;
If you want to submit articles use
.IR inews (1)
(which eventually execs a copy of rnews) or
.IR postnews (1)
(which calls inews) instead.
.PP
This program can also be invoked under names corresponding to some unbatching
programs in older versions in order to force various options on:
.PP
.nf
unbatch   -- force unbatching on
cunbatch  -- force unbatching and decompression on
c7unbatch -- force unbatching and decompression on, prefilter with decode
.fi
.PP
If the -p option and
.I pathname
(which should be a full pathname, not relative)
is given, the article will be read from the specified file; otherwise
the article will be read from the standard input.  An expiration date
need not be present and a reception date, if present, will be ignored.
.PP
After local installation,
.I rnews
will transmit the article to all systems
that subscribe to the newsgroups that the article belongs to.
It will also add an entry to the subject list file in each group.
The code will detect and properly handle input that has been compressed or
batched. The tests it performs are roughly equivalent to the following
pseudocode:
.PP
.nf
if (file begins with #)
{
    if (first line begins with #!)
    {
        if (line is a batch section header)
            enable batch mode;
    }
}

read a character;
if (it matches the first byte of the magic number for compressed files)
{
    push the character back;
    decompress the remainder of the input file
}
else
    push the character back;
.fi
.PP
These tests enable rnews to adapt itself to the standard format generated by
batch and csendbatch, i.e.
.PP
.nf
	# {rnews|unbatch|cunbatch|c7unbatch}
	#! rnews xxxx
	<article containing xxxx characters>
	#! rnews yyy
	<article containing yyy characters>
	    :
	    :
	#! rnews zzzz
	<article containing zzzz characters>
	<EOF>
.fi
.PP
The unbatching code recovers properly if the very first line is missing; in
that case it will act as if that line had been "# unbatch".
.PP
This feature replaces the
.IR unbatch (8)
and
.IR cunbatch (8)
programs of previous versions, speeding up the process a lot and incidentally 
plugging a security hole.
.PP
The -U option is used when you have the system configured to batch news
submission (and by
.IR expire (8)).
It causes input to be taken from SPOOL/.rnews, which is presumed to hold
a collection of news articles and/or batches previously spooled for
submission.
.PP
If an input batch begins with a non-alphanumeric and doesn't match any other
format, code for converting bnproc-style batches to standard form and then
processing them will be enabled. Also, the unbatching code normally deletes
notesfile headers from the article text, transferring them into special
RFC-822 conformant headers. These two features may be disabled via compilation
switches.
.PP
If rnews was compiled with -DDEBUG, the -D option causes action messages down
to the transport layer (uux invocation) to be emitted to stdout while
suppressing actual modification of the news database. This is intended to be
used for debugging and port-verification purposes.
.PP
The -P option allows the rnews to accept privileged control messages. 
If it is on, then privileges (if the executing user has them)
are \fInot\fR dropped.  In other words, in order to be executing in
privileged mode, you must be a) a privileged user, and b) have
specified the -P flag. This is normally used by inews, so that rnews will
honor privileged control messages like "inews -C".
.PP
The -o option causes posting invocations of rnews to report the message
ID assigned to the new article to the given file descriptor. It is intended
for use by posting programs that need to run rnews as a subprocess and get
the new ID back.
.PP
The \-d option of rnews causes rnews to run in \fIdaemon mode\fR (this may not
be available on non-UNIX systems). In daemon mode, rnews loops forever scanning
the spool directory for incoming batches, processing them and deleting them.
While doing this, it periodically writes out the active and history files so
readers will see the updates.
.PP
This mode is useful with the SPOOLNEWS compilation option; it avoids the
relatively large startup overhead of spawning an rnews per article. NNTP sites
in particular will probably want to use it.
.PP
Note that (in order to avoid security problems with control messages)
daemon-mode runs \fUunprivileged\fR! You must post control messages with
the no-spool (-u) flag for them to take effect. This will happen automatically
if you use inews or postnews, unless SPOOLPOST is on; in that case, you will
have to call rnews explicitly.
.PP
When
.I rnews
receives an article, it normally check the history file to make sure
that the article is not already present, and it will make certain consistency
checks to make sure that the newsgroup names are legal and that the sys file
permits the article to be installed on the local machine. Once the article
passes those checks, it is installed in the appropriate directory on the
local machine. If the article fails those checks, it is installed in
newsgroup
.Ch junk
on the local machine. In any event,
.I rnews
will then transmit the article to all systems that match in the sys file
and are not mentioned in the
.Ch Path:
field of the just-posted message. The details of this transmission are
determined by the contents of the sys file.
.PP
The rnews code broadcasts the message(s) fed to it according to the
following rules:
.PP
1. Cross-posting to multiple groups has the same effect as posting the
message to each group in turn.
.PP
2. Messages for ordinary (unmoderated, non-local) groups are broadcast to
each one of the site's news neighbors, and a copy is posted locally.
.PP
3. Messages for moderated groups are mailed to a moderator, if one can
be found in the moderators file. Otherwise, if the group is non-local
and the site has a backbone link, the submission is mailed to the backbone
as though the group name were a user there. In either case, the message
is \fInot\fR posted into the local article tree.
.PP
4. There is one exception to rule 3: if the posting user is listed as a
moderator of the group in the site's moderators file, rnews will generate a
suitable Approved: line in the header, then local-post and broadcast the
message as though the group were unmoderated.
.PP
5. Messages to local, unmoderated groups are local-posted and not
broadcast.
.SH FILES
.PD 0
.TP 25
/usr/spool/news/.sys.nnn
temporary articles
.TP 25
.RI /usr/spool/news/ newsgroups / article_no.
Articles
.TP 25
.RI /usr/spool/news/ newsgroups /.subjlist
Subject list files for each newsgroup
.TP 25
/usr/lib/news/active
List of known newsgroups and highest local article numbers in each.
.TP 25
/usr/lib/news/seq
Sequence number of last article
.TP 25
/usr/lib/news/history
List of all articles ever seen
.TP 25
/usr/lib/news/sys
System subscription list
.PD
.SH "SEE ALSO"
Mail(1),
binmail(1),
getdate(3),
msgs(1),
news(5),
newsrc(5),
postnews(1),
readnews(1),
mailnews(1),
vnews(1),
ednews(1),
recnews(1),
sendnews(8),
uucp(1),
uurec(8)
.SH AUTHORS
TMN version by Eric S. Raymond, based partly on earlier code by Matt
Glickman, Mark Horton, Stephen Daniel, and Tom R. Truscott. Daemon-mode
code by Ted T'so.
