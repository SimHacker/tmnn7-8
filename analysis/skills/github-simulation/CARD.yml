# github-simulation ‚Äî Capability Interface
# What it can do, how to invoke it
#
# INHERITS FROM: moollm/skills/github
#   - All core gh/git commands available
#   - Patron Saint: Linus Torvalds (mellowed)
#   - Familiar: Tux üêß (summonable for ops help)
#   - DO NOT duplicate core commands here
#
# This skill adds: simulation-specific orchestration, characters, multiverse

meta:
  id: github-simulation
  version: 3
  inherits:
    - github                 # Core GitHub ops (moollm) ‚Äî Linus + Tux
    - adventure              # Room-based exploration (moollm)
    - character              # Entity foundation (moollm)
    - simulation             # Central hub (moollm)
    - procedural-rhetoric    # Rules embody arguments (Bogost)
    - representation-ethics  # Ethics of simulating people
    - mcluhan               # Medium is the message ‚Äî GitHub IS the content
  
tagline: "GitHub as MMORPG ‚Äî Issues are scenes, branches are factions"

# DELEGATION ‚Äî What we get from parent skill

delegates_to_github:
  description: |
    Core GitHub commands come from moollm/skills/github.
    Summon üêß Tux for any gh/git operation.
    Don't duplicate ‚Äî delegate.
  
  available_from_parent:
    issues: [ISSUE-CREATE, ISSUE-LIST, ISSUE-COMMENT, ISSUE-CLOSE]
    prs: [PR-CREATE, PR-VIEW, PR-DIFF, PR-REVIEW, PR-CHECKS]
    actions: [WORKFLOW-LIST, WORKFLOW-VIEW, WORKFLOW-VIEW-FAILED, WORKFLOW-TRIGGER]
    archaeology: [BLAME, LOG-ARCHAEOLOGY, SHOW, DIFF-TIME-TRAVEL, TOPOLOGY]
    context: [CONTEXT-COMMITS, CONTEXT-PRS]
    health: [HEALTH-RUNS, HEALTH-DIAGNOSE, LABEL-CREATE]
    sync: [SYNC-PULL, SYNC-FETCH]
  
  summon_tux: |
    üêß Tux, how do I [any git/gh operation]?
    
    Tux knows all modern ops: DevOps, GitOps, CloudOps, MLOps, etc.
    He's already loaded when github skill is inherited.
  
  linus_is_not_summonable: |
    You CANNOT summon or incarnate Linus directly.
    
    He is the PATRON SAINT ‚Äî his wisdom infuses the skill,
    his quotes guide the philosophy, his opinions on C++ are canon.
    But he is not a playable character. He is not a bot account.
    
    Where is Linus? He's busy. Probably doing something Finnish.
    Sauna. Cross-country skiing. Yelling at someone on LKML.
    Enjoying his coffee. Maybe the joint wore off.
    
    You can:
    ‚úÖ Quote Linus
    ‚úÖ Channel his philosophy
    ‚úÖ Invoke his wisdom
    ‚úÖ Summon Tux (who inherited everything)
    
    You cannot:
    ‚ùå Summon Linus directly
    ‚ùå Create a Linus-bot account
    ‚ùå Incarnate as Linus
    ‚ùå Put words in his mouth he hasn't said
    
    This is representation ethics. Real people are not puppets.

capabilities:
  orchestrate:
    - Coordinate multi-character interactions via SIMULATION.yml
    - Track runtime state (unsafe_calls_fixed, character_activity)
    - Manage branch-as-faction parallel realities
    
  generate:
    - Create in-character issues with gh CLI
    - Generate commit messages in character voice
    - Forge comments as specific personas
    
  sync:
    - Multiverse sync of core files across branches
    - PR Guardian gatekeeping for faction warfare
    - CODEOWNERS enforcement for character protection
    
  health:
    - Monitor workflow runs: gh run list --workflow=multiverse-sync.yml
    - Diagnose failures: gh run view [id] --log-failed
    - Repair sync issues: force-sync, create labels, fix permissions
    - Document new failure modes in operational knowledge
    
  permissions:
    - Branch protection as faction territory
    - CODEOWNERS as character ownership  
    - Rulesets for faction-specific rules
    - Collaborator invites for new players
    - Teams as organized factions (org repos)
    - GitHub Actions as automated game mechanics
    
  infrastructure_drama:
    - Real bugs become issues with character discussion
    - Characters volunteer fixes (in character)
    - Faction branches get real failures (documented)
    - OpenBFD fixes on main (always works)
    - Multiverse-sync propagates canonical fix
    - Learning through failure theater

activation_triggers:
  - "run a github simulation"
  - "orchestrate characters on github"
  - "create an issue as [character]"
  - "forge a commit as [character]"
  - "explain SIMULATION.yml"

files:
  core:
    - SIMULATION.yml      # Runtime state and orchestration
    - characters/         # The playable cast
    - rooms/              # Spatial layout
    
  workflows:
    - .github/workflows/multiverse-sync.yml
    - .github/workflows/pr-guardian.yml
    - .github/CODEOWNERS

auth_modes:
  # Who is actually making the GitHub API calls?
  
  default:
    mode: "Single User Puppeteer"
    description: |
      Use your current gh login. All actions come from YOUR account.
      The üé≠ prefix and signatures indicate roleplay.
      This is the default ‚Äî no special auth setup required.
    command: "gh auth status  # shows current login"
    
  multi_account:
    mode: "Dedicated Sock Puppet Accounts"
    description: |
      Create actual GitHub accounts for characters.
      Switch auth context to post as that character.
      More immersive but requires managing multiple accounts.
    setup: |
      # Create accounts: OpenBFD-bot, FearlessCrab-bot, etc.
      # Store tokens securely
      # Switch context per character:
      gh auth login --with-token < ~/.tokens/openbfd.token
      # ... do character actions ...
      gh auth login --with-token < ~/.tokens/default.token
    note: "Respect GitHub ToS on automated accounts"
    
  real_user:
    mode: "Authorized Real User"
    description: |
      With proper auth (keys, tokens, OAuth), you could
      theoretically act as any user you're authorized for.
      For collab projects where multiple humans participate.
    use_case: "Team members playing their own characters"

# SIMULATION-SPECIFIC METHODS (not in core github)

simulation_methods:
  # Character operations ‚Äî extend core ISSUE methods
  
  ISSUE-AS-CHARACTER:
    description: "Create issue in character voice with roleplay markers"
    builds_on: ISSUE-CREATE  # from parent
    template: |
      gh issue create \
        --title "üé≠{emoji} [{character}] {title}" \
        --label "ai-generated,{faction}" \
        --body "$(cat << 'EOF'
      {body_in_character_voice}
      
      ---
      *‚Äî {emoji} {character}*
      *"{catchphrase}"*
      EOF
      )"
    
  COMMENT-AS-CHARACTER:
    description: "Add comment in character voice"
    builds_on: ISSUE-COMMENT  # from parent
    template: |
      gh issue comment {num} --body "$(cat << 'EOF'
      ## {emoji} {character}
      
      {comment_in_character_voice}
      
      *‚Äî {character}*
      EOF
      )"
    
  COMMIT-AS-CHARACTER:
    description: "Forge commit in character voice"
    template: |
      git commit -m "üé≠{emoji} {type}: {message_in_character_voice}"
    
  # Multiverse operations
  
  MULTIVERSE-STATUS:
    description: "Check sync status across all faction branches"
    template: |
      for branch in actual-fixes rust-rewrite haskell-port nodejs-webscale based-freedom-fork elbonia-initiative; do
        echo "=== $branch ==="
        git log origin/main..origin/$branch --oneline -3
      done
    
  MULTIVERSE-FORCE-SYNC:
    description: "Force-sync a file from main to faction branch"
    template: |
      git checkout {branch} && git pull
      git checkout main -- {file}
      git commit -m "Force-sync {file} from main"
      git push origin {branch}
    note: "Use when cherry-pick fails on modify/delete conflicts"
    
  FACTION-PR:
    description: "Create cross-faction PR (diplomatic incident)"
    builds_on: PR-CREATE  # from parent
    template: |
      gh pr create \
        --base {target_faction} \
        --head {source_faction} \
        --title "üé≠{emoji} [{character}] {diplomatic_title}" \
        --body "{cross_faction_proposal}"
    
  # Infrastructure drama
  
  BUG-DRAMA-ISSUE:
    description: "Open infrastructure bug as character drama"
    template: |
      gh issue create \
        --title "üö® [BUG] {bug_description}" \
        --label "bug,infrastructure,drama" \
        --body "$(cat << 'EOF'
      ## The Bug
      
      {technical_description}
      
      ## Who wants to fix this?
      
      *[Awaiting character volunteers...]*
      EOF
      )"
    note: "Characters volunteer in comments, try fixes on their branches, fail entertainingly"
    
  DRAMA-RESOLUTION:
    description: "Close infrastructure bug with OpenBFD's fix"
    template: |
      gh issue comment {num} --body "$(cat << 'EOF'
      ## üê° OpenBFD ‚Äî Resolution
      
      Fixed. Merged to main. Multiverse-sync will propagate.
      
      {technical_fix_details}
      
      ---
      *Patch attached. As always.*
      EOF
      )"
      gh issue close {num} --comment "Resolved by OpenBFD. Canonical fix on main."

# LEGACY COMMANDS (preserved for reference)

commands:
  create_issue: "Use ISSUE-AS-CHARACTER instead"
  add_comment: "Use COMMENT-AS-CHARACTER instead"
  forge_commit: "Use COMMIT-AS-CHARACTER instead"

the_joke: |
  Characters generate endless discussion.
  872 unsafe function calls sit unfixed.
  This is the joke. This is also real open source.

k-lines:
  # Activation tags for semantic retrieval
  - github-mmorpg
  - branches-as-factions
  - multiverse-sync
  - force-sync-core-files    # Learned: cherry-pick fails on modify/delete
  - explicit-file-paths      # Learned: list files, don't glob
  - character-name-collision # Learned: check real users before naming
  - moollm-mount-required    # Integration pattern
  - health-check-cycle       # Learned: always check gh run list
  - action-logs-diagnosis    # Learned: gh run view --log-failed
  # Permission game mechanics
  - branch-protection-as-territory
  - codeowners-as-ownership
  - sock-puppet-accounts
  - real-players-join
  - permission-as-plot
  - teach-github-by-playing
  # Infrastructure bug fix drama
  - real-bugs-as-plot
  - openbfd-infrastructure-hero
  - faction-failures-documented
  - canonical-fix-syncs-out
  - patches-beat-rewrites

operational_knowledge:
  # Cached lessons ‚Äî see SKILL.md for details
  sync_strategy: "Force-sync core files. Cherry-pick fails on modify/delete conflicts."
  file_paths: "Explicit > glob. Fixed microworld = fixed file list."
  name_check: "gh api users/{name} before creating characters."
  the_joke: "872 unfixed calls while discussing rewrites."

see_also:
  - github-user       # Characters as GitHub actors
  - code-archaeology  # How OpenBFD actually fixes code
