# TMNN Vulnerability Analysis - Deep Code Review
# YAML Jazz: Quantified security archaeology

summary:
  total_c_lines: 23549
  files_analyzed: 104
  methodology: "grep pattern matching + manual review of high-risk files"
  reviewer: "Cursor AI"
  date: 2026-01-30

vulnerability_counts:
  # Verified counts from code analysis
  
  buffer_overflows:
    unsafe_string_functions: 774
    breakdown:
      sprintf: "unbounded format strings"
      strcat: "concatenation to fixed buffers"
      strcpy: "no length validation"
    files_affected: 104
    worst_offenders:
      - file: src/D.news/escapes.c
        count: 45
      - file: src/bbsauto.c
        count: 27
      - file: src/readnews.c
        count: 26
      - file: src/control.c
        count: 25
      - file: src/insert.c
        count: 24
      - file: src/postnews.c
        count: 23
      - file: src/post.c
        count: 22
      - file: src/D.priv/transmit.c
        count: 21
        
  temp_file_races:
    mktemp_instances: 42
    vulnerability: "Predictable temp file names enable symlink attacks"
    attack_scenario: |
      Attacker predicts temp filename, creates symlink to /etc/passwd,
      news system overwrites target file with attacker-controlled content.
    mitigation_available_in_1989: "mkstemp()"
    files_affected:
      - src/rnews.c
      - src/inews.c
      - src/D.priv/collect.c
      - src/D.priv/transmit.c
      - src/bbsauto.c
      - src/mailnews.c
      
  command_injection:
    system_popen_total: 61
    breakdown:
      system_calls: "passes user input to shell"
      popen_calls: "same vulnerability"
    attack_scenario: |
      User crafts article with shell metacharacters in headers,
      news system passes to shell, attacker code executes as news user.
    worst_offenders:
      - file: src/sendbatch.c
        count: 7
      - file: src/D.priv/transmit.c
        count: 5
      - file: src/control.c
        count: 4
      - file: src/insert.c
        count: 4
      - file: src/mailnews.c
        count: 4

  gets_function:
    count: 1
    location: src/system.h
    severity: CRITICAL
    note: |
      gets() was removed from C11 standard entirely because it is
      fundamentally unfixable - no way to prevent buffer overflow.
      Its presence even in a header file indicates systemic disregard
      for input validation.

lock_file_vulnerabilities:
  file: src/D.priv/lock.c
  
  esr_self_assessment:
    quote: "The Version 7/System III implementation is ugly and flaky."
    location: "BUGS section of header comment, line 22"
    shipped_anyway: true
    
  issues:
    hardcoded_key:
      code: '#define NEWSKEY 2317L'
      comment: "Hail Eris, All Hail Discordia!"
      # Discordian reference - very on-brand for ESR
      vulnerability: "Any process knowing this key can manipulate semaphore"
      
    tmp_lockfile:
      code: '#define NEWSLOCK "/tmp/NEWSLOCK"'
      vulnerability: "World-writable /tmp, any user can DoS news system"
      
    xenix_semaphore:
      code: 'private char sem_name[] = "/tmp/.active_lock"'
      vulnerability: "Same /tmp issue"

fascist_c_vulnerabilities:
  file: src/D.news/fascist.c
  
  getgrplist_overflow:
    function: getgrplist()
    code: |
      static char grplist[LBUFLEN];
      while (gr = getgrent()) {
          (void) strcat(grplist, gr->gr_name);
          (void) strcat(grplist, ",");
      }
    vulnerability: "User in many groups overflows fixed buffer"
    esr_comment: "This routine is a HOG!!!!!"
    # He knew it was bad, documented it was bad, shipped it anyway
    
  addrestrict_overflow:
    function: addrestrict()
    code: |
      (void) strcat(rblk->n_post, psubsc);
      (void) strcat(rblk->n_read, rsubsc);
    vulnerability: "Long restriction strings overflow"

irony_metrics:
  # The "many eyes" guy's own code
  
  many_eyes_applied: 0
  # Code sat in "secret laboratories" for 2 years
  
  bugs_found_before_release: unknown
  # No evidence of code review
  
  bugs_remaining_at_abandonment: "uncounted"
  
  years_until_first_public_analysis: 37
  # 1989 to 2026

comparison_to_later_claims:
  wrote_catb: 1997
  catb_thesis: "given enough eyeballs, all bugs are shallow"
  own_code_eyeballs: ~0
  own_code_bugs: "deep and numerous"
  
  wrote_taoup: 2003
  taoup_topic: "Unix programming best practices"
  own_code_practices: "violated most of them"

secure_alternatives_available_in_1989:
  # ESR could have used these
  - function: snprintf
    instead_of: sprintf
    
  - function: strncat
    instead_of: strcat
    
  - function: strncpy
    instead_of: strcpy
    
  - function: mkstemp
    instead_of: mktemp
    
  - pattern: "fork/exec with argument array"
    instead_of: "system() with string concatenation"
